require "net/http"
require "uri"
require "jwt"
require "time"


class rubyClient
	def initialize (baseURL, service_id, secret)
		@baseURL=baseURL
		@service_id=service_id
		@secret=secret
	end

	def create_api_token
		iat = Time.now.to_i
		iss = client_id {}

		exp = Time.now.to_i + 4 * 3600
		exp_payload =  {:iss => service_id, :iat => Time.now.to_i}

		token = JWT.encode exp_payload, secret, 'HS256'

		decoded_token = JWT.decode token, hmac_secret, true, { :algorithm => 'HS256' }


	end


	def send_email(to, template, personalisation)



	uri = URI.parse("https://staging-api.notifications.service.gov.uk/notifications/email")

	# Shortcut
	response = Net::HTTP.post_form(uri)

	# Full control
	http = Net::HTTP.new(uri.host, uri.port)

	request = Net::HTTP::Post.new(uri.request_uri)
	request.set_form_data({
		
		"to" => to,
  		"template" => template,
  		"personalisation" => personalisation
	})

	response = http.request(request)

	puts response.code
	puts response.body

	headers = {
           "Content-type" => "application/json",
           "Authorization" => "Bearer {}".format(api_token),
           "User-agent" => "NOTIFY-API-RUBY-CLIENT/{}".format(__version__),
       }



		
	end





	def send_sms

		
	end

end



